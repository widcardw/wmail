# Wmail

## Project Structure

This is a project that uses Go + WailsV3 + Solidjs.

- frontend/ => using pnpm
  - bindings/ => automatically generated by Go/Wails
  - public/ => static assets
  - src/
    - components/
      - layouts/ => all possible layouts for frontend, may include router sidebars
      - ui/ => custom ui components with css (the css files should be `xxx.module.css`)
    - pages/ => all page routers
    - stores/ => global data stores with solid-js/store api
    - styles/ => global styles
    - utils/ => useful api for all frontend contents
    - index.tsx => solid-js entry file
    - vite-env.d.ts => ts declaration file
  - index.html
  - package.json => manage deps
  - tsconfig.json => alias `src/*` to `~/*`, `bindings/*` to `#/*`
  - uno.config.ts => unocss configs including primary/secondary/mut/destructive color, variants: (DEFAULT, fg, hover)
  - vite.config.ts => Vite config, `vite-plugin-pages`, `unocss` and alias are enabled
- services/
  - osservice.go => to provide some OS utils like GetOS, OpenFolder
  - greetservice.go => example service
- go.mod
- go.sum
- main.go => add the services to main program to generate bindings

## Frontend UI

The UI library is `@ark-ui/solid`. Full documents refer to https://ark-ui.com/docs/overview/about or https://ark-ui.com/llms-solid.txt

Icons using unocss, https://icones.js.org/collection/ri with collection `@icones-json/ri`, example `<div class="w-4 h-4 i-ri-home-2-line" />`

## Backend Service

Wails V3 https://v3alpha.wails.io/

### Call Go Function from Frontend

For example, we have `services/greeteservice.go`

```go
package services

type GreetService struct{}

func (g *GreetService) Greet(name string) string {
	return "Hello " + name + "!"
}
```

Then apply the service in `main.go`

```go
app := application.New(application.Options{
		// ...
		Services: []application.Service{
			application.NewService(&services.GreetService{}), // apply here
		},
		// ...
	})
```

In frontend pages, we do

```ts
import { GreetService } from '#/wmail/services'
async function getGreetMsg(name: str) {
  return await GreetService.Greet(name)  // Hello ${name}!
}
```

### Get Application Instance in Go Functions

We often use the app instance to invoke global events.

```go
import "github.com/wailsapp/wails/v3/pkg/application"
// ...
app := application.Get()
app.Event.Emit("progress:edge", ProgressEvent{
  finished: i+1,
  total: len(segments),
})
```

In frontend, we can listen the event and update the progress bar.

```ts
import {Events} from '@wailsio/runtime'
const cleanupEdgeProgressListener = Events.On('progress:edge', (data: {name: string; data: {total: number; finished: number}}) => {
  const {total, finished} = data.data
})
```

## Dev

```sh
wails3 dev
```
